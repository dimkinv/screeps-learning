# Простая шпаргалка по библиотеке Screeps

## Основные перечисления

### `Role`
- **Что это:** роли ваших крипов: `harvester`, `worker`, `soldier`.
- **Зачем нужно:** помогает запоминать, чем должен заниматься конкретный крип.
- **Пример:** `creep.setRole(Role.Harvester)`.

### `ActionStatus`
- **Что это:** строковые статусы вроде `MOVING`, `HARVESTING`, `NO_TARGET` и т.д.
- **Зачем нужно:** понять, как прошла операция (например, получилось ли достичь цели или не хватило пути).
- **Пример:** `const result = creep.moveTo(source); if (result === ActionStatus.NO_PATH) { /* ищем другой путь */ }`.

## Класс `SimpleCreep`
`SimpleCreep` оборачивает обычного крипа и добавляет удобные методы. Создаётся так: `const myCreep = new SimpleCreep(Game.creeps["Имя"]);`

### Энергия и перемещение
- **`findClosestSource()`**
  - Ищет ближайший источник энергии в комнате.
  - Параметры: нет.
  - Возвращает: `Source` или `null`.
  - Пример: найти источник и подойти к нему.
- **`full()` / `empty()` / `needsEnergy()` / `hasRoomForEnergy()`**
  - Проверяют, заполнен ли крип энергией, пустой ли он, нужно ли пополнить и есть ли место.
  - Параметры: нет.
  - Возвращает: `boolean`.
  - Пример: если `needsEnergy()` — отправить собирать энергию.
- **`getEnergyLevel()` / `getEnergyCapacity()`**
  - Сколько энергии несёт крип и максимальная вместимость.
  - Параметры: нет.
  - Возвращает: число.
  - Пример: показать в консоли прогресс: `logStatus(`${getEnergyLevel()}/${getEnergyCapacity()}`);`.
- **`isNear(target, range = 1)` / `isAt(position)`**
  - Проверка близости или точного совпадения с клеткой.
  - Параметры: цель и (опционально) радиус.
  - Возвращает: `boolean`.
  - Пример: если не рядом — двигаться ближе.
- **`moveTo(target)`**
  - Движение к объекту/позиции.
  - Параметры: цель.
  - Возвращает: `ActionStatus` (`MOVING`, `ALREADY_THERE`, `NO_PATH`, `ERROR`).
  - Пример: `creep.moveTo(source)`.
- **`moveNear(target)`**
  - Двигаться, пока не окажется в радиусе 1.
  - Параметры: цель.
  - Возвращает: `ActionStatus` (`MOVING`, `ALREADY_NEAR`, `NO_PATH`, `ERROR`).
  - Пример: подойти к строительной площадке.
- **`stayAwayFrom(target, distance)`**
  - Убегать, пока дистанция не станет больше или равна `distance`.
  - Параметры: цель, минимальная дистанция.
  - Возвращает: `ActionStatus` (`SAFE`, `RETREATING`, `NO_PATH`, `ERROR`).
  - Пример: держаться подальше от врага.
- **`moveToFlag(flagName)`**
  - Идти к флагу в той же комнате.
  - Параметры: имя флага.
  - Возвращает: статус движения или `NO_TARGET`.
  - Пример: быстро послать крипа к метке `"MineHere"`.
- **`goHome()`**
  - Идти к домашнему спавну и остановиться рядом.
  - Параметры: нет.
  - Возвращает: `MOVING` или `ALREADY_THERE`/`NO_TARGET`.
  - Пример: вернуть уставшего крипа к базе.

### Сбор и передача энергии
- **`harvest(source)`**
  - Добывает энергию у источника рядом.
  - Параметры: `Source`.
  - Возвращает: `HARVESTING`, `NOT_IN_RANGE` или `ERROR`.
  - Пример: если стоим рядом с источником — добываем.
- **`transferEnergyTo(target)`**
  - Перенос энергии в здание или объект; двигается, если далеко.
  - Параметры: структура/объект.
  - Возвращает: `TRANSFERRING`, `MOVING`, `EMPTY` или `ERROR`.
  - Пример: наполнить башню энергией.
- **`withdraw(target)`**
  - Забрать энергию из контейнера/хранилища рядом.
  - Параметры: структура.
  - Возвращает: `WITHDRAWING`, `NOT_IN_RANGE` или `ERROR`.
  - Пример: взять энергию из контейнера у источника.
- **`pickupOrWithdrawEnergy()`**
  - Авто: подбирает упавшую энергию или вытаскивает из контейнера/хранилища.
  - Параметры: нет.
  - Возвращает: статус (например, `PICKING_UP`, `WITHDRAWING`, `MOVING`, `FULL`, `NO_TARGET`).
  - Пример: быстро пополнить запасы любым способом.
- **`findEnergyDropOrContainer()`**
  - Находит лучшую цель для энергии: сначала дроп, потом контейнер, потом хранилище.
  - Параметры: нет.
  - Возвращает: объект ресурса/контейнер/хранилище или `null`.
  - Пример: узнать, куда идти за энергией.
- **`storeEnergyToBase()`**
  - Если есть энергия и рядом спавн — передаёт туда.
  - Параметры: нет.
  - Возвращает: `TRANSFERRING`, `EMPTY`, `NO_TARGET` или `ERROR`.
  - Пример: быстрый слив в спавн.
- **`fillExtensionsAndSpawn()`**
  - Наполняет спавн и расширения.
  - Параметры: нет.
  - Возвращает: статус передачи/движения или `NO_TARGET`/`EMPTY`.
  - Пример: обеспечить генерацию новых крипов.
- **`storeEnergyInContainers()`**
  - Кладёт энергию в контейнеры или хранилище.
  - Параметры: нет.
  - Возвращает: статус передачи/движения или `NO_TARGET`/`EMPTY`.
  - Пример: убрать лишнюю энергию на склад.
- **`deliverEnergyToBase()`**
  - Полный цикл: спавн → расширения → башни → контейнеры/хранилище.
  - Параметры: нет.
  - Возвращает: статус передачи/движения или `NO_TARGET`/`EMPTY`.
  - Пример: универсальная команда «отнеси энергию куда нужно».

### Работа строителя
- **`upgradeController()`**
  - Улучшает контроллер комнаты, двигается ближе при необходимости.
  - Параметры: нет.
  - Возвращает: `UPGRADING`, `MOVING`, `EMPTY` или `NO_TARGET`.
  - Пример: использовать лишнюю энергию для прокачки комнаты.
- **`buildClosestSite()`**
  - Ищет ближайшую стройку и строит её.
  - Параметры: нет.
  - Возвращает: `BUILDING`, `MOVING`, `EMPTY`, `NO_SITE` или `NO_TARGET`.
  - Пример: автоматическое строительство ближайшего объекта.
- **`buildAt(position)`**
  - Строит конкретную стройку по позиции.
  - Параметры: `RoomPosition`.
  - Возвращает: статус строительства, `NO_SITE`/`NO_TARGET`/`EMPTY`.
  - Пример: строить башню именно на выбранной клетке.
- **`repairClosestDamagedStructure()`**
  - Находит и чинит ближайшее повреждённое здание.
  - Параметры: нет.
  - Возвращает: `REPAIRING`, `MOVING`, `EMPTY` или `NO_TARGET`.
  - Пример: поддерживать стены и дороги целыми.
- **`repair(target)`**
  - Чинит указанную структуру (подойдёт на 3 клетки).
  - Параметры: структура.
  - Возвращает: `REPAIRING`, `MOVING` или `EMPTY`/`ERROR`.
  - Пример: чинить башню после боя.
- **`hasWork()`**
  - Проверяет, есть ли что строить/чинить/улучшать.
  - Параметры: нет.
  - Возвращает: `boolean`.
  - Пример: если нет работы — переключиться на добычу.
- **`doWork()`**
  - Сам выбирает задачу: строить → чинить → улучшать.
  - Параметры: нет.
  - Возвращает: статус выбранного действия или `NO_TARGET`.
  - Пример: простой ИИ строителя «делай лучшее доступное дело».

### Бой и защита
- **`attackClosestHostile()`**
  - Ближняя атака ближайшего врага.
  - Параметры: нет.
  - Возвращает: `ATTACKING`, `MOVING` или `NO_TARGET`/`ERROR`.
  - Пример: защитник бежит на ближайшую угрозу.
- **`rangedAttackClosestHostile()`**
  - Стреляет по ближайшему врагу, подходя на дистанцию ≤3.
  - Параметры: нет.
  - Возвращает: `ATTACKING`, `MOVING` или `NO_TARGET`/`ERROR`.
  - Пример: лучник держит дистанцию и стреляет.
- **`kiteHostile()`**
  - Стреляет, удерживая безопасную дистанцию.
  - Параметры: нет.
  - Возвращает: `RETREATING`, `ATTACKING`, `MOVING` или `NO_TARGET`.
  - Пример: хит‑ран тактика против врагов.
- **`healSelfIfNeeded()`**
  - Лечит себя, если получил урон.
  - Параметры: нет.
  - Возвращает: `HEALING` или `HEALTHY`/`ERROR`.
  - Пример: солдат подлечивается после боя.
- **`hasHostilesInRoom()`**
  - Проверяет, есть ли враги в комнате (метод крипа).
  - Параметры: нет.
  - Возвращает: `boolean`.
  - Пример: решить, надо ли включать оборону.
- **`fleeToBase()`**
  - Отступает к базе, если рядом враги; иначе просто идёт домой.
  - Параметры: нет.
  - Возвращает: статус движения или `NO_TARGET`.
  - Пример: рабочий убегает в безопасное место.

### Роли и память
- **`getRole()` / `setRole(role)` / `is(role)`**
  - Читают/записывают роль крипа и проверяют её.
  - Параметры: роль (для `setRole`/`is`).
  - Возвращает: роль или `boolean`.
  - Пример: `if (creep.is(Role.Worker)) creep.doWork();`.
- **`remember(key, value)` / `recall(key)`**
  - Сохраняют и читают свои данные в памяти крипа.
  - Параметры: ключ и значение / ключ.
  - Возвращает: сохранённое значение или `undefined`.
  - Пример: хранить, какой источник закреплён за крипом.
- **`logStatus(message)`**
  - Печатает сообщение с именем и ролью крипа.
  - Параметры: текст.
  - Возвращает: ничего.
  - Пример: `creep.logStatus("несу энергию домой")`.

## Полезные функции (не методы крипа)
- **`towerDefendBase(tower)`**
  - Простой ИИ для башни: атакует врагов → чинит сильно повреждённые здания → лечит союзников.
  - Параметры: `StructureTower`.
  - Возвращает: `ActionStatus` (`ATTACK`, `REPAIR`, `HEAL`, `IDLE`, `EMPTY`, `ERROR`).
  - Пример: вызывать в каждом тике для каждой башни.
- **`hasHostilesInRoom(room)`**
  - Проверяет, есть ли враги в комнате (глобальная функция).
  - Параметры: `Room`.
  - Возвращает: `boolean`.
  - Пример: включить тревогу, если вернёт `true`.
- **`onTick(callback)`** и **`runTickHandlers()`**
  - Регистрирует функции, которые будут вызываться каждый тик, и запускает их.
  - Параметры: функция‑обработчик / нет.
  - Возвращает: ничего.
  - Пример: `onTick(() => PopulationManager.maintainPopulation(...));` затем `runTickHandlers()` внутри `loop`.
- **`forEachCreep(handler)`**
  - Вызывает обработчик для каждого крипа, передавая `SimpleCreep`.
  - Параметры: функция `(creep) => { ... }`.
  - Возвращает: ничего.
  - Пример: выполнить одинаковое поведение для всех крипов.
- **`runRole(handlers)`**
  - Запускает разные функции в зависимости от роли крипа.
  - Параметры: объект вида `{ [Role.Worker]: (c) => c.doWork() }`.
  - Возвращает: ничего.
  - Пример: распределить крипов по их заданиям.

## Менеджер популяции: `PopulationManager`
Используется как синглтон: `PopulationManager.метод()`.

- **`canBuildCreep(role)`**
  - Проверяет, может ли главный спавн сейчас начать крипа этой роли.
  - Параметры: роль.
  - Возвращает: `boolean`.
  - Пример: прежде чем тратить энергию, убедиться, что спавн свободен.
- **`buildCreep(role)`**
  - Пытается запустить создание крипа; тело подбирается автоматически по доступной энергии.
  - Параметры: роль.
  - Возвращает: строку результата (`SPAWNING`, `NOT_ENOUGH_ENERGY`, `SPAWN_BUSY`, `ERROR`).
  - Пример: `PopulationManager.buildCreep(Role.Harvester)`.
- **`getCreepCount(role)`**
  - Считает, сколько крипов с такой ролью существует.
  - Параметры: роль.
  - Возвращает: число.
  - Пример: вывод в консоль текущего количества добытчиков.
- **`maintainCreepsAtRole(role, targetCount)`**
  - Гарантирует минимум `targetCount` крипов роли: если мало — пытается заспавнить.
  - Параметры: роль, желаемое число.
  - Возвращает: статус (`CAPPED`, `SPAWNING`, `BLOCKED`, `OK`).
  - Пример: держать всегда 2 строителей.
- **`maintainPopulation(targets)`**
  - Делает `maintainCreepsAtRole` сразу для нескольких ролей.
  - Параметры: объект `{ [Role.Harvester]: 2, [Role.Worker]: 3 }`.
  - Возвращает: объект статусов по ролям.
  - Пример: простой планировщик населения.
- **`getQueuedSpawns()`**
  - Список текущих спавн‑задач с временем до готовности.
  - Параметры: нет.
  - Возвращает: массив объектов `{ role, name, remainingTime, spawnName }`.
  - Пример: показать очередь спавна на экране.
- **`forEachCreepOfRole(role, handler)`**
  - Пройдётся по всем крипам указанной роли и вызовет обработчик с `SimpleCreep`.
  - Параметры: роль и функция.
  - Возвращает: ничего.
  - Пример: всем солдатам дать команду атаковать.

## Как использовать в основном цикле
1. В файле `main.ts` или `loop.ts` импортируйте нужные элементы: `import { SimpleCreep, PopulationManager, runTickHandlers, onTick, Role } from "./index";`.
2. Зарегистрируйте действия на каждый тик через `onTick(...)`.
3. Внутри `module.exports.loop` вызывайте `runTickHandlers();`.
4. Добавляйте свою логику с методами `SimpleCreep` и менеджера — теперь они под рукой!
